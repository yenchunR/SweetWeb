{"ast":null,"code":"var _jsxFileName = \"/Users/ruru/react_hello/src/Component/Search.js\";\nimport React, { Component } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst apiKey = \"5ae2e3f221c38a28845f05b61de3e1c96cc4be1e55e26b5e8166170a\";\n\nfunction apiGet(method, query) {\n  return new Promise(function (resolve, reject) {\n    var otmAPI = \"https://api.opentripmap.com/0.1/en/places/\" + method + \"?apikey=\" + apiKey;\n\n    if (query !== undefined) {\n      otmAPI += \"&\" + query;\n    }\n\n    fetch(otmAPI).then(response => response.json()).then(data => resolve(data)).catch(function (err) {\n      console.log(\"Fetch Error :-S\", err);\n    });\n  });\n}\n\nconst pageLength = 5;\nlet offset = 0;\nlet lon = 0;\nlet lat = 0;\nlet count = 0;\n\nfunction onShowPOI(data) {\n  let poi = document.getElementById(\"poi\");\n  poi.innerHTML = \"\";\n\n  if (data.preview) {\n    poi.innerHTML += `<img src=\"${data.preview.source}\">`;\n  }\n\n  poi.innerHTML += data.wikipedia_extracts ? data.wikipedia_extracts.html : data.info ? data.info.descr : \"No description\";\n  poi.innerHTML += `<p><a target=\"_blank\" href=\"${data.otm}\">Show more at OpenTripMap</a></p>`;\n}\n\nfunction createListItem(item) {\n  let a = document.createElement(\"a\");\n  a.className = \"list-group-item list-group-item-action\";\n  a.setAttribute(\"data-id\", item.xid);\n  a.innerHTML = `<h5 class=\"list-group-item-heading\">${item.name}</h5>\n      <p class=\"list-group-item-text\">${getCategoryName(item.kinds)}</p>`;\n  a.addEventListener(\"click\", function () {\n    document.querySelectorAll(\"#list a\").forEach(function (item) {\n      item.classList.remove(\"active\");\n    });\n    this.classList.add(\"active\");\n    let xid = this.getAttribute(\"data-id\");\n    apiGet(\"xid/\" + xid).then(data => onShowPOI(data));\n  });\n  return a;\n}\n\nfunction loadList() {\n  apiGet(\"radius\", `radius=1000&limit=${pageLength}&offset=${offset}&lon=${lon}&lat=${lat}&rate=2&format=json`).then(function (data) {\n    let list = document.getElementById(\"list\");\n    list.innerHTML = \"\";\n    data.forEach(item => list.appendChild(createListItem(item)));\n    let nextBtn = document.getElementById(\"next_button\");\n\n    if (count < offset + pageLength) {\n      nextBtn.style.visibility = \"hidden\";\n    } else {\n      nextBtn.style.visibility = \"visible\";\n      nextBtn.innerText = `Next (${offset + pageLength} of ${count})`;\n    }\n  });\n}\n\nfunction firstLoad() {\n  apiGet(\"radius\", `radius=1000&limit=${pageLength}&offset=${offset}&lon=${lon}&lat=${lat}&rate=2&format=count`).then(function (data) {\n    count = data.count;\n    offset = 0;\n    document.getElementById(\"info\").innerHTML += `<p>${count} objects with description in a 1km radius</p>`;\n    loadList();\n  });\n}\n\nfunction getCountryName(countryCode) {\n  if (isoCountries.hasOwnProperty(countryCode)) {\n    return isoCountries[countryCode];\n  } else {\n    return countryCode;\n  }\n}\n\nfunction capitalizeFirstLetter(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nfunction parsePlural(label) {\n  var sb_single = new Array(\"\");\n  var sb_plural = new Array(\"\");\n  var spaces = 0;\n\n  for (var i = 0; i < label.length; i++) {\n    var ch = label.charAt(i);\n\n    if (ch != \"[\") {\n      sb_single.push(ch);\n      sb_plural.push(ch);\n\n      if (ch == \" \") {\n        spaces++;\n      } else {\n        spaces = 0;\n      }\n    } else {\n      var sb = new Array(\"\");\n      var j = i + 1;\n\n      for (; j < label.length; j++) {\n        ch = label.charAt(j);\n        if (ch == \"]\") break;\n        sb.push(ch);\n      }\n\n      var len = j - i - 1;\n      i = sb_plural.length;\n      sb_plural.splice(Math.max(0, i - len), len);\n      sb_plural.push(sb.join(\"\"));\n\n      if (spaces != 0) {\n        i = sb_single.length;\n        sb_single.splice(Math.max(0, i - spaces), spaces);\n      }\n\n      i = j;\n    }\n  }\n\n  return {\n    single: capitalizeFirstLetter(sb_single.join(\"\")),\n    plural: sb_plural.join(\"\")\n  };\n}\n\nfunction getCategoryName(kinds) {\n  let names = [];\n  kinds.split(\",\").forEach(function (kind) {\n    let item = layer_names[kind];\n    if (item) names.push(parsePlural(item.n).single);\n  });\n  return names.join(\", \");\n}\n\ndocument.getElementById(\"search_form\").addEventListener(\"submit\", function (event) {\n  let name = document.getElementById(\"textbox\").value;\n  apiGet(\"geoname\", \"name=\" + name).then(function (data) {\n    let message = \"Name not found\";\n\n    if (data.status == \"OK\") {\n      message = data.name + \", \" + getCountryName(data.country);\n      lon = data.lon;\n      lat = data.lat;\n      firstLoad();\n    }\n\n    document.getElementById(\"info\").innerHTML = `<p>${message}</p>`;\n  });\n  event.preventDefault();\n});\ndocument.getElementById(\"next_button\").addEventListener(\"click\", function () {\n  offset += pageLength;\n  loadList();\n});\nexport default class Search extends Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"body\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"container\",\n        children: [/*#__PURE__*/_jsxDEV(\"form\", {\n          id: \"search_form\",\n          class: \"input-group mb-4 border p-1\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"input-group-prepend border-0\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              id: \"button-search\",\n              type: \"submit\",\n              class: \"btn btn-link \",\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                class: \"fa fa-search\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 187,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 186,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"textbox\",\n            type: \"search\",\n            placeholder: \"Region, city, village, etc. (e.g. Moscow)\",\n            \"aria-describedby\": \"button-search\",\n            class: \"form-control bg-none border-0\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"info\",\n          class: \"alert alert-primary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"col-12 col-lg-5\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"list\",\n              class: \"list-group\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"nav\", {\n              class: \"text-center\",\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                id: \"next_button\",\n                type: \"button\",\n                class: \"btn btn-primary\",\n                children: \"Next\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"col-12 col-lg-7\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              id: \"poi\",\n              class: \"alert\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 210,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/ruru/react_hello/src/Component/Search.js"],"names":["React","Component","apiKey","apiGet","method","query","Promise","resolve","reject","otmAPI","undefined","fetch","then","response","json","data","catch","err","console","log","pageLength","offset","lon","lat","count","onShowPOI","poi","document","getElementById","innerHTML","preview","source","wikipedia_extracts","html","info","descr","otm","createListItem","item","a","createElement","className","setAttribute","xid","name","getCategoryName","kinds","addEventListener","querySelectorAll","forEach","classList","remove","add","getAttribute","loadList","list","appendChild","nextBtn","style","visibility","innerText","firstLoad","getCountryName","countryCode","isoCountries","hasOwnProperty","capitalizeFirstLetter","string","charAt","toUpperCase","slice","parsePlural","label","sb_single","Array","sb_plural","spaces","i","length","ch","push","sb","j","len","splice","Math","max","join","single","plural","names","split","kind","layer_names","n","event","value","message","status","country","preventDefault","Search","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\n\nconst apiKey = \"5ae2e3f221c38a28845f05b61de3e1c96cc4be1e55e26b5e8166170a\";\n\nfunction apiGet(method, query) {\n    return new Promise(function (resolve, reject) {\n        var otmAPI =\n            \"https://api.opentripmap.com/0.1/en/places/\" +\n            method +\n            \"?apikey=\" +\n            apiKey;\n        if (query !== undefined) {\n            otmAPI += \"&\" + query;\n        }\n        fetch(otmAPI)\n            .then(response => response.json())\n            .then(data => resolve(data))\n            .catch(function (err) {\n                console.log(\"Fetch Error :-S\", err);\n            });\n    });\n}\n\nconst pageLength = 5;\n\nlet offset = 0;\nlet lon = 0;\nlet lat = 0;\nlet count = 0;\n\nfunction onShowPOI(data) {\n    let poi = document.getElementById(\"poi\");\n    poi.innerHTML = \"\";\n    if (data.preview) {\n        poi.innerHTML += `<img src=\"${data.preview.source}\">`;\n    }\n    poi.innerHTML += data.wikipedia_extracts\n        ? data.wikipedia_extracts.html\n        : data.info\n            ? data.info.descr\n            : \"No description\";\n\n    poi.innerHTML += `<p><a target=\"_blank\" href=\"${data.otm}\">Show more at OpenTripMap</a></p>`;\n}\n\nfunction createListItem(item) {\n    let a = document.createElement(\"a\");\n    a.className = \"list-group-item list-group-item-action\";\n    a.setAttribute(\"data-id\", item.xid);\n    a.innerHTML = `<h5 class=\"list-group-item-heading\">${item.name}</h5>\n      <p class=\"list-group-item-text\">${getCategoryName(item.kinds)}</p>`;\n\n    a.addEventListener(\"click\", function () {\n        document.querySelectorAll(\"#list a\").forEach(function (item) {\n            item.classList.remove(\"active\");\n        });\n        this.classList.add(\"active\");\n        let xid = this.getAttribute(\"data-id\");\n        apiGet(\"xid/\" + xid).then(data => onShowPOI(data));\n    });\n    return a;\n}\n\nfunction loadList() {\n    apiGet(\n        \"radius\",\n        `radius=1000&limit=${pageLength}&offset=${offset}&lon=${lon}&lat=${lat}&rate=2&format=json`\n    ).then(function (data) {\n        let list = document.getElementById(\"list\");\n        list.innerHTML = \"\";\n        data.forEach(item => list.appendChild(createListItem(item)));\n        let nextBtn = document.getElementById(\"next_button\");\n        if (count < offset + pageLength) {\n            nextBtn.style.visibility = \"hidden\";\n        } else {\n            nextBtn.style.visibility = \"visible\";\n            nextBtn.innerText = `Next (${offset + pageLength} of ${count})`;\n        }\n    });\n}\n\nfunction firstLoad() {\n    apiGet(\n        \"radius\",\n        `radius=1000&limit=${pageLength}&offset=${offset}&lon=${lon}&lat=${lat}&rate=2&format=count`\n    ).then(function (data) {\n        count = data.count;\n        offset = 0;\n        document.getElementById(\n            \"info\"\n        ).innerHTML += `<p>${count} objects with description in a 1km radius</p>`;\n        loadList();\n    });\n}\nfunction getCountryName(countryCode) {\n    if (isoCountries.hasOwnProperty(countryCode)) {\n      return isoCountries[countryCode];\n    } else {\n      return countryCode;\n    }\n  }\n  \n  function capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n  }\n  \n  function parsePlural(label) {\n    var sb_single = new Array(\"\");\n    var sb_plural = new Array(\"\");\n    var spaces = 0;\n    for (var i = 0; i < label.length; i++) {\n      var ch = label.charAt(i);\n      if (ch != \"[\") {\n        sb_single.push(ch);\n        sb_plural.push(ch);\n        if (ch == \" \") {\n          spaces++;\n        } else {\n          spaces = 0;\n        }\n      } else {\n        var sb = new Array(\"\");\n        var j = i + 1;\n        for (; j < label.length; j++) {\n          ch = label.charAt(j);\n          if (ch == \"]\") break;\n          sb.push(ch);\n        }\n        var len = j - i - 1;\n        i = sb_plural.length;\n        sb_plural.splice(Math.max(0, i - len), len);\n        sb_plural.push(sb.join(\"\"));\n        if (spaces != 0) {\n          i = sb_single.length;\n          sb_single.splice(Math.max(0, i - spaces), spaces);\n        }\n        i = j;\n      }\n    }\n    return {\n      single: capitalizeFirstLetter(sb_single.join(\"\")),\n      plural: sb_plural.join(\"\")\n    };\n  }\n  \n  function getCategoryName(kinds) {\n    let names = [];\n    kinds.split(\",\").forEach(function(kind) {\n      let item = layer_names[kind];\n      if (item) names.push(parsePlural(item.n).single);\n    });\n    return names.join(\", \");\n  }\n  \ndocument\n    .getElementById(\"search_form\")\n    .addEventListener(\"submit\", function (event) {\n        let name = document.getElementById(\"textbox\").value;\n        apiGet(\"geoname\", \"name=\" + name).then(function (data) {\n            let message = \"Name not found\";\n            if (data.status == \"OK\") {\n                message = data.name + \", \" + getCountryName(data.country);\n                lon = data.lon;\n                lat = data.lat;\n                firstLoad();\n            }\n            document.getElementById(\"info\").innerHTML = `<p>${message}</p>`;\n        });\n        event.preventDefault();\n    });\n\ndocument\n    .getElementById(\"next_button\")\n    .addEventListener(\"click\", function () {\n        offset += pageLength;\n        loadList();\n    });\n\nexport default class Search extends Component{\n    render(){\n        return(\n            <body>\n            <div class=\"container\">\n                <form id=\"search_form\" class=\"input-group mb-4 border p-1\">\n                    <div class=\"input-group-prepend border-0\">\n                        <button id=\"button-search\" type=\"submit\" class=\"btn btn-link \">\n                            <i class=\"fa fa-search\"></i>\n                        </button>\n                    </div>\n                    <input\n                        id=\"textbox\"\n                        type=\"search\"\n                        placeholder=\"Region, city, village, etc. (e.g. Moscow)\"\n                        aria-describedby=\"button-search\"\n                        class=\"form-control bg-none border-0\"\n                    />\n                </form>\n\n                <div id=\"info\" class=\"alert alert-primary\"></div>\n                <div class=\"row\">\n                    <div class=\"col-12 col-lg-5\">\n                        <div id=\"list\" class=\"list-group\"></div>\n                        <nav class=\"text-center\">\n                            <button id=\"next_button\" type=\"button\" class=\"btn btn-primary\">\n                                Next\n                            </button>\n                        </nav>\n                    </div>\n                    <div class=\"col-12 col-lg-7\">\n                        <div id=\"poi\" class=\"alert\"></div>\n                    </div>\n                </div>\n            </div>\n            </body>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}